<?php

function runmemo_init()
{
	//to add the js file
	drupal_add_js(drupal_get_path("module","runmemo")."/runmemo.js");

}



//form alter function
function runmemo_form_alter(&$form, $form_state, $form_id)
{


	if($form['#form_id']=='amazon_s3_file_upload_form')
	{

		

		//for changing the single file upload to drag and drop file upload change #type=>plupload
		$form['box']['file']['#type']='plupload';
		
		//change the already existing button value upload->start upload
		$form['box']['upload']['#value']='Start upload';


		


	}


	if($form['#form_id']=='user_register_form')
	{
	
	

		$base_path=base_path().'sites/default/help_icon.gif';

		//create the select role radio buttons in the create account page
		$form['field_select_user']=array('#type' => 'radios','#title'=> 'Select Role','#id'=> 'role','#attributes'=>array('onclick'=>'user_photographer()'),'#options'=>array('runner'=>'Runner','photographer'=>'Photographer'),'#weight'=>'4','#required'=>'1');

		$form['field_select_user2']=array('#markup'=>"<div id='paypal_title' style='color:black'>Paypal Account Id</div>",'#weight'=>'5');

                $form['field_select_user1']=array('#type'=>'textfield','#title'=> '','#id'=> 'paypal_account_id','#weight'=>'6');

		$form['field_select_user3']=array('#markup'=>"<p><span title='Your Paypal account ID' id='paypal_icon' style='float:right;padding-right:102px;padding-top:18px;color:red;'><img src='$base_path'></img></span></p>",'#weight'=>'5');


		/*echo "<pre>";
		print_r($form);
		exit;*/


		//add the form submit function for insert the user role in the user table
                $form['#submit']['1']= 'user_role_insertion'; 
		//$form['#validate']['4'] = 'my_mod_my_form_id_validate';


	}
}


//function for insert the user role in the user table when submit the create account submit button
function user_role_insertion($form,&$from_state)
{

	if(isset($form['#user']->field_select_user) && ($form['#user']->field_select_user=='runner'))
	{
		$user_role=db_query("SELECT rid FROM role WHERE name='Runner'");
		foreach($user_role as $user_role_value)
		{
			$role_id=$user_role_value->rid;
		}
		$uid=$form['#user']->uid;
		db_query("Update users SET role=$role_id WHERE uid=$uid");

		db_insert('users_roles')
					      	->fields(array(
						'uid' => $uid,
						'rid' => $role_id,
						))->execute();
		drupal_goto('user');
	}

	if(isset($form['#user']->field_select_user) && ($form['#user']->field_select_user=='photographer'))
	{
		$user_role=db_query("SELECT rid FROM role WHERE name='Photographer'");
		foreach($user_role as $user_role_value)
		{
			$role_id=$user_role_value->rid;
		}
		$uid=$form['#user']->uid;
		db_query("Update users SET role=$role_id WHERE uid=$uid");
		
		//insert the paypal account id in the photographer account table
		if(isset($form['#user']->field_select_user1) && ($form['#user']->field_select_user1 != ''))
		{
			$photographer_account_id=$form['#user']->field_select_user1;
			
			db_insert('photographer_account')
					      	->fields(array(
						'paypal_account_id' => $photographer_account_id,
						'uid' => $uid,
						))->execute();

			db_insert('users_roles')
					      	->fields(array(
						'uid' => $uid,
						'rid' => $role_id,
						))->execute();
			drupal_goto('<front>');
		}
	}

}

/*
function my_mod_my_form_id_validate($form, &$form_state) {


	if ($form['field_select_user'] == '') {
	form_set_error($form['field_select_user'], t('Custom error message'));
	}
}
*/

